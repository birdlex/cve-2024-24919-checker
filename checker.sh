#!/bin/bash

ARCH=$(uname -m)
LINUX_Release=$(uname -r | grep -o -m 1 -E '^[23]\.[61][0]?')
CP_Info=$(cpinfo -y all | grep -m 1 '_JUMBO_HF_MAIN')
CP_Version=$(echo $CP_Info | grep -o -E 'R8[01]_?([01234][0])?([S][P])?' | sed 's/_/./g')
CP_Take=$(echo $CP_Info | grep -o -E '[0-9]{2,3}$')

RED='\033[31m'
GREEN='\033[32m'
YELLOW='\033[33m'
BLUE='\033[34m'
PLAIN='\033[0m'
BOLD='\033[1m'
SUCCESS='[\033[32mOK\033[0m]'
COMPLETE='[\033[32mDONE\033[0m]'
WARN='[\033[33mWARN\033[0m]'
ERROR='[\033[31mERROR\033[0m]'
WORKING='[\033[34m*\033[0m]'

echo ${CP_Info} > /dev/null
echo ${LINUX_Release} > /dev/null
echo ${CP_Version} > /dev/null
echo ${CP_Take} > /dev/null

if (enabled_blades | grep -q 'vpn'); then
	CP_VPN=true
else
	CP_VPN=false
fi

echo -e "\n${GREEN}Linux Kerner: ${LINUX_Release} ${PLAIN}\n"
echo -e "${GREEN}VPN Enabled: ${CP_VPN} ${PLAIN}\n"
echo -e "${GREEN}Current Check Point Version: ${CP_Version} ${PLAIN}\n"
echo -e "${GREEN}Current Check Point Take: ${CP_Take} ${PLAIN}\n"

case ${CP_Version} in
R81.20)
	case ${CP_Take} in
	26)
		echo -e "${GREEN}Check Point Version: R81.20_T26 ${PLAIN}\n"
	;;
	41)
		echo -e "${GREEN}Check Point Version: R81.20_T41 ${PLAIN}\n"
	;;
	53)
		echo -e "${GREEN}Check Point Version: R81.20_T53 ${PLAIN}\n"
	;;
	54)
		echo -e "${GREEN}Check Point Version: R81.20_T54 ${PLAIN}\n"
	;;
	*)
		echo -e "${WARN}Please upgrade to Take version 26, 41, 53, 54 before install patch ${PLAIN}\n"
	;;
	esac
;;
R81.10)
	case ${CP_Take} in
	110)
		echo -e "${GREEN}Check Point Version: R81.10_T110 ${PLAIN}\n"
	;;
	130)
		echo -e "${GREEN}Check Point Version: R81.10_T130 ${PLAIN}\n"
	;;
	139)
		echo -e "${GREEN}Check Point Version: R81.10_T139 ${PLAIN}\n"
	;;
	141)
		echo -e "${GREEN}Check Point Version: R81.10_T141 ${PLAIN}\n"
	;;
	*)
		echo -e "${WARN}Please upgrade to Take version 110, 130, 139, 141 before install patch${PLAIN}\n"
	;;
	esac
;;
R81)
	case ${CP_Take} in
	92)
		echo -e "${GREEN}Check Point Version: R81_T92 ${PLAIN}\n"
	;;
	*)
		echo -e "${WARN}Please upgrade to Take version 92 before install patch${PLAIN}\n"
	;;
	esac
;;
R80.40)
	case ${CP_Take} in
	197)
		echo -e "${GREEN}Check Point Version: R80.40_T197 ${PLAIN}\n"
	;;
	198)
		echo -e "${GREEN}Check Point Version: R80.40_T198 ${PLAIN}\n"
	;;
	206)
		echo -e "${GREEN}Check Point Version: R80.40_T206 ${PLAIN}\n"
	;;
	211)
		echo -e "${GREEN}Check Point Version: R80.40_T211 ${PLAIN}\n"
	;;
	*)
		echo -e "${WARN}Please upgrade to Take version 197, 198, 206, 211 before install patch${PLAIN}\n"
	;;
	esac
;;
R80.30)
	case ${CP_Take} in
	255)
		case ${LINUX_Release} in
		3.10)
			echo -e "${GREEN}Check Point Version: R80.30_T255_3.10 ${PLAIN}\n"
		;;
		2.6)
			echo -e "${GREEN}Check Point Version: R80.30_T255_2.6 ${PLAIN}\n"
		;;
		*)
			echo -e "${WARN}Please upgrade to Take version 255 before install patch${PLAIN}\n"
		;;
		esac
	;;
	esac
;;
R80.20)
	case ${CP_Take} in
	230)
		echo -e "${GREEN}Check Point Version: R80.20_T230 ${PLAIN}\n"
	;;
	*)
		echo -e "${WARN}Please upgrade to Take version 230 before install patch${PLAIN}\n"
	;;
	esac
;;
R80.10)
	case ${CP_Take} in
	298)
		echo -e "${GREEN}Check Point Version: R80.10_T298 ${PLAIN}\n"
	;;
	*)
		echo -e "${WARN}Please upgrade to Take version 298 before install patch${PLAIN}\n"
	;;
	esac
;;
esac